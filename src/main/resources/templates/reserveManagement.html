<html layout:decorate="~{layout}">
<div layout:fragment="content">
    <h3 class="border-bottom pb-2">예약 관리</h3>
    <div class="btn-group my-3">
        <a href="javascript:void(0)" class="버튼 btn" aria-current="page" id="searchAll">예약 목록</a>
        <a href="javascript:void(0)" class="버튼 btn" id="searchByRestaurant">가게별</a>
        <a href="javascript:void(0)" class="버튼 btn" id="searchByDate">날짜별</a>
    </div>
    <table class="table table-hover">
        <thead style="background:peachpuff;">
        <tr class="text-center">
            <th>가게</th>
            <th>예약자 성함</th>
            <th>인원 수</th>
            <th>날짜</th>
            <th>시간</th>
            <th>예약 상태</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="reservation, loop:${paging}" class="text-center">
            <td th:text="${reservation.restaurant.name}"></td>
            <td th:text="${reservation.user.name}"></td>
            <td th:text="${reservation.count}"></td>
            <td th:text="${reservation.date}"></td>
            <td th:text="${reservation.time}"></td>
            <td style="width:10%;">
                <div th:if="${reservation.status == null}">
                    <button class="btn btn-sm btn-outline-success me-2" id="approveBtn">승인
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-check" viewBox="0 0 16 16">
                            <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                        </svg>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" id="refuseBtn">거절
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-x"
                             viewBox="0 0 16 16">
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                    </button>
                </div>
                <div th:if="${reservation.status != null}" th:text="${reservation.status}"></div>
            </td>
            <form th:action="@{|/reserve/status/${reservation.id}|}" method="post" id="statusForm">
                <input type="hidden" id="status" name="status">
            </form>
        </tr>
        </tbody>
    </table>
    <div th:if="${!paging.isEmpty()}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
                <a class="page-link"
                   th:href="@{|?page=${paging.number-1}|}">
                    <span>이전</span>
                </a>
            </li>
            <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
                th:classappend="${page == paging.number} ? 'active'"
                class="page-item">
                <a th:text="${page}" class="page-link" th:href="@{|?page=${page}|}"></a>
            </li>
            <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
                <a class="page-link" th:href="@{|?page=${paging.number+1}|}">
                    <span>다음</span>
                </a>
            </li>
        </ul>
    </div>
    <form th:action="@{/reserve/manage}" method="get" id="viewForm">
        <input type="hidden" id="view" name="view">
    </form>
    <script layout:fragment="script" type='text/javascript'>
        const byRestaurant = document.getElementById("searchByRestaurant");
        byRestaurant.addEventListener('click', function() {
            document.querySelector("#view").value = byRestaurant.innerText;
            document.querySelector("#viewForm").submit();
        });

        var approveText = document.getElementById("approveBtn").innerText;
        const approve = document.getElementById("approveBtn");
        approve.addEventListener('click', function() {
            document.querySelector("#status").value = approveText;
            if (confirm("예약을 확정하시겠습니까?")) {
                document.querySelector("#statusForm").submit();
            }
        });

        var refuseText = document.getElementById("refuseBtn").innerText;
        const refuse = document.getElementById("refuseBtn");
        refuse.addEventListener('click', function() {
            document.querySelector("#status").value = refuseText;
            if (confirm("예약을 거부하시겠습니까?")) {
                document.querySelector("#statusForm").submit();
            }
        });
    </script>
</div>
</html>